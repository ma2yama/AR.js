!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("three")):"function"==typeof define&&define.amd?define(["three"],e):"object"==typeof exports?exports.THREEx=e(require("three")):t.THREEx=e(t.THREE)}(this,(t=>(()=>{"use strict";var e={381:e=>{e.exports=t}},i={};function n(t){var o=i[t];if(void 0!==o)return o.exports;var s=i[t]={exports:{}};return e[t](s,s.exports,n),s.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{n.r(o),n.d(o,{DeviceOrientationControls:()=>l,LocationBased:()=>p,WebcamRenderer:()=>g});var t=n(381);const e=new t.Vector3(0,0,1),i=new t.Euler,s=new t.Quaternion,a=new t.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),r={type:"change"},h=2*Math.PI,c=.5*Math.PI;class l extends t.EventDispatcher{object;enabled;screenOrientation;alphaOffset;deviceOrientation;lastOrientation;orientationChangeEventName;smoothingFactor;connect;disconnect;update;dispose;_orderAngle;_getSmoothedAngle;constructor(n){super(),window.isSecureContext||console.error("THREE.DeviceOrientationControls: DeviceOrientationEvent is only available in secure contexts (https)");const o=new t.Quaternion;this.object=n,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.screenOrientation=0,this.alphaOffset=0,this.orientationChangeEventName="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation",this.smoothingFactor=1;const l=t=>{this.deviceOrientation={alpha:t.alpha,beta:t.beta,gamma:t.gamma}},d=()=>{this.screenOrientation=window.screen.orientation.angle||0,console.log(this.screenOrientation)};this.connect=()=>{d(),"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&(window.screen.orientation.addEventListener("change",d),window.addEventListener(this.orientationChangeEventName,l))})).catch((t=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",t)})):(window.screen.orientation.addEventListener("change",d),window.addEventListener(this.orientationChangeEventName,l)),this.enabled=!0},this.disconnect=()=>{window.screen.orientation.removeEventListener("change",d),window.removeEventListener(this.orientationChangeEventName,l),this.enabled=!1},this.update=()=>{if(!this.enabled)return;const n=this.deviceOrientation;if(null!=n){let h=null!=n.alpha?t.MathUtils.degToRad(n.alpha)+this.alphaOffset:0,l=null!=n.beta?t.MathUtils.degToRad(n.beta):0,d=null!=n.gamma?t.MathUtils.degToRad(n.gamma):0;const u=this.screenOrientation?t.MathUtils.degToRad(this.screenOrientation):0;if(this.smoothingFactor<1){if(null!=this.lastOrientation?.alpha&&null!=this.lastOrientation?.beta&&null!=this.lastOrientation?.gamma){const t=this.smoothingFactor;h=this._getSmoothedAngle(h,this.lastOrientation.alpha,t),l=this._getSmoothedAngle(l+Math.PI,this.lastOrientation.beta,t),d=this._getSmoothedAngle(d+c,this.lastOrientation.gamma,t,Math.PI)}else l+=Math.PI,d+=c;this.lastOrientation={alpha:h,beta:l,gamma:d}}((t,n,o,r,h)=>{i.set(o,n,-r,"YXZ"),t.setFromEuler(i),t.multiply(a),t.multiply(s.setFromAxisAngle(e,-h))})(this.object.quaternion,h,this.smoothingFactor<1?l-Math.PI:l,this.smoothingFactor<1?d-c:d,u),8*(1-o.dot(this.object.quaternion))>1e-6&&(o.copy(this.object.quaternion),this.dispatchEvent(r))}},this._orderAngle=(t,e,i=h)=>e>t&&Math.abs(e-t)<i/2||t>e&&Math.abs(e-t)>i/2?{left:t,right:e}:{left:e,right:t},this._getSmoothedAngle=(t,e,i,n=h)=>{const o=this._orderAngle(t,e,n),s=o.left,a=o.right;o.left=0,o.right-=s,o.right<0&&(o.right+=n);let r=a==e?(1-i)*o.right+i*o.left:i*o.right+(1-i)*o.left;return r+=s,r>=n&&(r-=n),r},this.dispose=()=>{this.disconnect()},this.connect()}}const d=20037508.34;class u{constructor(){}project(t,e){return[this.lonToSphMerc(t),this.latToSphMerc(e)]}unproject(t){return[this.sphMercToLon(t[0]),this.sphMercToLat(t[1])]}lonToSphMerc(t){return t/180*d}latToSphMerc(t){return Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180)*d/180}sphMercToLon(t){return t/d*180}sphMercToLat(t){let e=t/d*180;return e=180/Math.PI*(2*Math.atan(Math.exp(e*Math.PI/180))-Math.PI/2),e}getID(){return"epsg:3857"}}class p{_scene;_camera;_proj;_eventHandlers;_lastCoords;_gpsMinDistance;_gpsMinAccuracy;_maximumAge;_watchPositionId;initialPosition;initialPositionAsOrigin;constructor(t,e,i={}){this._scene=t,this._camera=e,this._proj=new u,this._eventHandlers={},this._lastCoords=null,this._gpsMinDistance=0,this._gpsMinAccuracy=100,this._maximumAge=0,this._watchPositionId=null,this.setGpsOptions(i),this.initialPosition=null!=i.initialPosition?this._proj.project(i.initialPosition.longitude,i.initialPosition.latitude):null,this.initialPositionAsOrigin=null!=i.initialPosition||!0===i.initialPositionAsOrigin||!1}setProjection(t){this._proj=t}setGpsOptions(t={}){void 0!==t.gpsMinDistance&&(this._gpsMinDistance=t.gpsMinDistance),void 0!==t.gpsMinAccuracy&&(this._gpsMinAccuracy=t.gpsMinAccuracy),void 0!==t.maximumAge&&(this._maximumAge=t.maximumAge)}startGps(t=0){return null===this._watchPositionId&&(this._watchPositionId=navigator.geolocation.watchPosition((t=>{this._gpsReceived(t)}),(t=>{this._eventHandlers.gpserror?this._eventHandlers.gpserror(t.code):alert(`GPS error: code ${t.code}`)}),{enableHighAccuracy:!0,maximumAge:0!=t?t:this._maximumAge}),!0)}stopGps(){return null!==this._watchPositionId&&(navigator.geolocation.clearWatch(this._watchPositionId),this._watchPositionId=null,!0)}fakeGps(t,e,i=null,n=0){null!==i&&this.setElevation(i),this._gpsReceived({coords:{longitude:t,latitude:e,accuracy:n}})}lonLatToWorldCoords(t,e){const i=this._proj.project(t,e);if(this.initialPositionAsOrigin){if(!this.initialPosition)throw"Trying to use 'initial position as origin' mode with no initial position determined";i[0]-=this.initialPosition[0],i[1]-=this.initialPosition[1]}return[i[0],-i[1]]}add(t,e,i,n){this.setWorldPosition(t,e,i,n),this._scene.add(t)}setWorldPosition(t,e,i,n){const o=this.lonLatToWorldCoords(e,i);null!=n&&(t.position.y=n),[t.position.x,t.position.z]=o}setElevation(t){this._camera.position.y=t}onGpsError(t){this._eventHandlers.gpserror=t}onGpsUpdate(t){this._eventHandlers.gpsupdate=t}setWorldOrigin(t,e){this.initialPosition=this._proj.project(t,e)}_gpsReceived(t){let e=Number.MAX_VALUE;null!=t.coords.accuracy&&t.coords.accuracy<=this._gpsMinAccuracy&&(null===this._lastCoords?this._lastCoords={latitude:t.coords.latitude,longitude:t.coords.longitude}:e=this._haversineDist(this._lastCoords,t.coords),e>=this._gpsMinDistance&&(this._lastCoords.longitude=t.coords.longitude,this._lastCoords.latitude=t.coords.latitude,this.initialPositionAsOrigin&&!this.initialPosition&&this.setWorldOrigin(t.coords.longitude,t.coords.latitude),this.setWorldPosition(this._camera,t.coords.longitude,t.coords.latitude,t.coords.altitude),this._eventHandlers.gpsupdate&&this._eventHandlers.gpsupdate(t,e)))}_haversineDist(e,i){const n=t.MathUtils.degToRad(i.longitude-e.longitude),o=t.MathUtils.degToRad(i.latitude-e.latitude),s=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t.MathUtils.degToRad(e.latitude))*Math.cos(t.MathUtils.degToRad(i.latitude))*(Math.sin(n/2)*Math.sin(n/2));return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3}}class g{renderer;sceneWebcam;geom;texture;material;cameraWebcam;constructor(e,i){let n;this.renderer=e,this.renderer.autoClear=!1,this.sceneWebcam=new t.Scene,void 0===i?(n=document.createElement("video"),n.setAttribute("autoplay","true"),n.setAttribute("playsinline","true"),n.style.display="none",document.body.appendChild(n)):n=i,this.geom=new t.PlaneGeometry,this.texture=new t.VideoTexture(n),this.material=new t.MeshBasicMaterial({map:this.texture});const o=new t.Mesh(this.geom,this.material);this.sceneWebcam.add(o),this.cameraWebcam=new t.OrthographicCamera(-.5,.5,.5,-.5,0,10),navigator.mediaDevices.getUserMedia({video:{width:1280,height:720,facingMode:"environment"}}).then((t=>{console.log("using the webcam successfully..."),n.srcObject=t,n.play()})).catch((t=>{setTimeout((()=>{this.createErrorPopup("Webcam Error\nName: "+t.name+"\nMessage: "+t.message)}),1e3)}))}update(){this.renderer.clear(),this.renderer.render(this.sceneWebcam,this.cameraWebcam),this.renderer.clearDepth()}dispose(){this.material.dispose(),this.texture.dispose(),this.geom.dispose()}createErrorPopup(t){if(!document.getElementById("error-popup")){const e=document.createElement("div");e.innerHTML=t,e.setAttribute("id","error-popup"),document.body.appendChild(e)}}}})(),o})()));